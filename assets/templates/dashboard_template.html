<!doctype html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>TTN Dashboard – Light</title>
<link rel="stylesheet" href="../templates/dashboard.css?v=1">

<h1>TTN Dashboard – Grouped by Sensor Type</h1>
<small>As of: {{STAMP}} • Source: TTN Storage ({{APP}}@{{REG}}) • Window: last {{AFTER_DAYS}} days • AFTER={{AFTER}}</small>

<div class="tabs">
  <button class="active" data-tab="overview">Übersicht</button>
  <button data-tab="charts">Diagramme</button>
  <button data-tab="debug">Debug</button>
  <button data-tab="info">Info</button>
</div>

<section id="tab-overview">
  <div class="card">
    <h2>Übersicht (aktuelle Werte)</h2>
    {{OVERVIEW_CARDS}}
  </div>

  <div class="card">
    <h2>Geräte-Tabelle</h2>
    {{OVERVIEW_TABLE}}
    <p style="margin-top:8px"><small>
      Parquet: <code>data/&lt;device&gt;.parquet</code> •
      CSV: <code>data/&lt;device&gt;.csv</code> •
      NDJSON (raw): <code>data/&lt;device&gt;_raw.ndjson</code>
    </small></p>
  </div>
</section>

<section id="tab-charts" hidden>
  <div class="type-grid">
    {{TYPE_CARDS}}
  </div>
</section>

<section id="tab-debug" hidden>
  {{DEBUG_CARDS}}
</section>

<section id="tab-info" hidden>
  <div class="card">
    <h2>Allgemeine Formate im Repo</h2>
    <div class="info-grid">
      <div>
        <h3>NDJSON (Newline Delimited JSON)</h3>
        <ul>
          <li>Jede Zeile ein JSON-Objekt → ideal für Streaming &amp; APIs.</li>
          <li>Direkt auswertbar mit <code>jq</code>, <code>pandas.read_json(..., lines=True)</code>, <code>jsonlite::stream_in()</code>.</li>
        </ul>
        <pre class="mono"># bash / jq
head -n 3 data/&lt;device&gt;_raw.ndjson | jq .
# Python / pandas
import pandas as pd
df = pd.read_json("data/&lt;device&gt;_raw.ndjson", lines=True)</pre>
        <p><small>Hinweis: <code>data/&lt;device&gt;_raw.ndjson</code> enthält die rohen TTN-Storage-Antworten pro Pull (optional append/snapshot).</small></p>
      </div>

      <div>
        <h3>Parquet</h3>
        <ul>
          <li>Spaltenorientiert, binär, sehr kompakt &amp; schnell.</li>
          <li>Für Analysen/Abfragen optimiert – Standard in Spark, DuckDB, BigQuery etc.</li>
        </ul>
        <pre class="mono"># Python / pandas
import pandas as pd
df = pd.read_parquet("data/&lt;device&gt;.parquet")</pre>
        <p>Typischer Workflow: Rohdaten zuerst als NDJSON persistieren → für Analyse/Archiv in Parquet konvertieren.</p>
      </div>

      <div>
        <h3>CSV</h3>
        <ul>
          <li>Mensch- &amp; toollesbar, maximal interoperabel (Excel, R, GIS, Shell).</li>
          <li>Wird vom Script zusätzlich zu Parquet erzeugt: <code>data/&lt;device&gt;.csv</code>.</li>
        </ul>
        <pre class="mono"># Python / pandas (mit Timestamps)
import pandas as pd
df = pd.read_csv("data/&lt;device&gt;.csv", parse_dates=["received_at"])
# Schnellblick (Shell)
head -n 3 data/&lt;device&gt;.csv</pre>
        <p><small>Hinweis: Das Script **liest bevorzugt Parquet** (Performance). CSV dient als offenes Austauschformat und Fallback.</small></p>
      </div>
    </div>
  </div>

  <div class="card">
    <h2>Sensoren &amp; Felder</h2>
    <table>
      <thead>
        <tr>
          <th>Sensor</th>
          <th>Wichtige Felder</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td><strong>DDS75-LB</strong> <small>(<code>dds75-lb-*.parquet</code>)</small></td>
          <td><code>distance_cm</code> (bzw. <code>Distance_mm</code>), <code>temperature</code>, <code>battery</code>, Flags: <code>interrupt_flag</code>, <code>sensor_flag</code></td>
        </tr>
        <tr>
          <td><strong>PS-LB</strong> <small>(<code>burgwald-ps-lb-*.parquet</code>)</small></td>
          <td><code>water_cm</code> bzw. <code>pressure_kpa</code>/<code>pressure_mpa</code>, zusätzlich <code>idc_input_ma</code>, <code>vdc_input_v</code>, <code>battery</code>, digitale Eingänge</td>
        </tr>
        <tr>
          <td><strong>SenseCAP</strong> <small>(<code>burgwald-sensecap-*.parquet</code>)</small></td>
          <td><code>temperature</code>, <code>humidity</code>, <code>pressure_hpa</code>, <code>illumination</code>, ggf. <code>uv_index</code>, <code>wind_speed</code>, <code>wind_dir</code>, <code>rainfall</code></td>
        </tr>
      </tbody>
    </table>
    <p style="margin-top:8px"><small>Hinweis: Das Dashboard gruppiert Devices automatisch nach Sensor-Typ und zeigt Betriebswerte (Battery/RSSI/SNR/Power) in einem Sammel-Diagramm.</small></p>
  </div>
</section>


<script src="../templates/dashboard.js?v=1" defer></script>

